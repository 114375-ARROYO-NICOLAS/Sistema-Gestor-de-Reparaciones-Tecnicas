<div class="container-fluid py-4">
  <p-toast />

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3 class="m-0">Marcas</h3>
      <p-button
        label="Nueva Marca"
        icon="pi pi-plus"
        (onClick)="openCreateDialog()">
      </p-button>
    </div>

    <div class="card-body">
      <p-table
        [value]="marcas()"
        [loading]="isLoading()"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20]"
        [globalFilterFields]="['descripcion']"
        responsiveLayout="scroll"
        styleClass="p-datatable-sm">

        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>Descripción</th>
            <th style="width: 100px">Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-marca>
          <tr>
            <td>{{ marca.id }}</td>
            <td>{{ marca.descripcion }}</td>
            <td>
              <p-button
                icon="pi pi-pencil"
                [text]="true"
                [rounded]="true"
                severity="warn"
                (onClick)="openEditDialog(marca)"
                pTooltip="Editar"
                tooltipPosition="top">
              </p-button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center">No se encontraron marcas</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Dialog for Create/Edit -->
  <p-dialog
    [header]="isEditMode() ? 'Editar Marca' : 'Nueva Marca'"
    [(visible)]="showDialog"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{width: '500px'}">

    <form [formGroup]="marcaForm" (ngSubmit)="saveMarca()">
      <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción <span class="text-danger">*</span></label>
        <input
          pInputText
          id="descripcion"
          formControlName="descripcion"
          class="w-100"
          placeholder="Ingrese descripción de la marca"
          maxlength="100" />

        @if (marcaForm.get('descripcion')?.invalid && marcaForm.get('descripcion')?.touched) {
          <small class="text-danger d-block mt-1">
            @if (marcaForm.get('descripcion')?.errors?.['required']) {
              La descripción es requerida
            }
            @if (marcaForm.get('descripcion')?.errors?.['maxlength']) {
              La descripción no puede exceder 100 caracteres
            }
          </small>
        }
      </div>
    </form>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancelar"
        severity="secondary"
        (onClick)="closeDialog()"
        [disabled]="isSaving()">
      </p-button>
      <p-button
        [label]="isEditMode() ? 'Actualizar' : 'Crear'"
        (onClick)="saveMarca()"
        [loading]="isSaving()">
      </p-button>
    </ng-template>
  </p-dialog>
</div>
