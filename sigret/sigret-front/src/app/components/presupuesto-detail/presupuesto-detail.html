<div class="presupuesto-detail-container p-4">
  <!-- Header with Back Button -->
  <div class="flex justify-content-between align-items-center mb-4">
    <h2 class="text-3xl font-semibold m-0">Detalle del Presupuesto</h2>
    <p-button
      label="Volver"
      icon="pi pi-arrow-left"
      [outlined]="true"
      (onClick)="goBack()">
    </p-button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="flex justify-content-center align-items-center py-8">
      <p-progressSpinner
        [style]="{ width: '50px', height: '50px' }"
        strokeWidth="4"
        animationDuration="1s">
      </p-progressSpinner>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="flex align-items-center gap-3 p-4 border-round bg-red-50 border-1 border-red-200">
      <i class="pi pi-exclamation-triangle text-red-600 text-2xl"></i>
      <span class="flex-1 text-red-800">{{ error() }}</span>
      <p-button
        label="Volver"
        icon="pi pi-arrow-left"
        severity="danger"
        [outlined]="true"
        (onClick)="goBack()">
      </p-button>
    </div>
  }

  <!-- Presupuesto Details -->
  @if (!loading() && !error() && presupuesto()) {
    <div class="grid">
      <!-- Main Information Card -->
      <div class="col-12 lg:col-8">
        <p-card>
          <ng-template pTemplate="header">
            <div class="flex justify-content-between align-items-center p-3">
              <h3 class="m-0">Información del Presupuesto</h3>
              <p-badge
                [value]="getEstadoLabel(presupuesto()!.estado)"
                [severity]="getEstadoBadgeSeverity(presupuesto()!.estado)">
              </p-badge>
            </div>
          </ng-template>

          <div class="flex flex-column gap-3">
            <div class="grid">
              <div class="col-12 md:col-6">
                <div class="flex flex-column gap-2">
                  <label class="text-sm font-semibold text-600">Número de Presupuesto</label>
                  <span class="text-lg">{{ presupuesto()!.numeroPresupuesto }}</span>
                </div>
              </div>

              <div class="col-12 md:col-6">
                <div class="flex flex-column gap-2">
                  <label class="text-sm font-semibold text-600">Número de Servicio</label>
                  <span class="text-lg">{{ presupuesto()!.numeroServicio }}</span>
                </div>
              </div>
            </div>

            <p-divider></p-divider>

            <div class="grid">
              <div class="col-12 md:col-6">
                <div class="flex flex-column gap-2">
                  <label class="text-sm font-semibold text-600">Cliente</label>
                  <div class="flex align-items-center gap-2">
                    <i class="pi pi-user text-primary"></i>
                    <span class="text-lg">{{ presupuesto()!.clienteNombre }}</span>
                  </div>
                </div>
              </div>

              @if (presupuesto()!.equipoDescripcion) {
                <div class="col-12 md:col-6">
                  <div class="flex flex-column gap-2">
                    <label class="text-sm font-semibold text-600">Equipo</label>
                    <div class="flex align-items-center gap-2">
                      <i class="pi pi-desktop text-primary"></i>
                      <span class="text-lg">{{ presupuesto()!.equipoDescripcion }}</span>
                    </div>
                  </div>
                </div>
              }
            </div>

            <p-divider></p-divider>

            <div class="grid">
              <div class="col-12 md:col-6">
                <div class="flex flex-column gap-2">
                  <label class="text-sm font-semibold text-600">Monto Total</label>
                  <div class="flex align-items-center gap-2">
                    <i class="pi pi-dollar text-green-600"></i>
                    <span class="text-2xl font-bold text-green-600">{{ formatCurrency(presupuesto()!.montoTotal) }}</span>
                  </div>
                </div>
              </div>

              @if (presupuesto()!.empleadoNombre) {
                <div class="col-12 md:col-6">
                  <div class="flex flex-column gap-2">
                    <label class="text-sm font-semibold text-600">Técnico Asignado</label>
                    <div class="flex align-items-center gap-2">
                      <i class="pi pi-user-edit text-primary"></i>
                      <span class="text-lg font-semibold text-primary assigned-employee-detail">{{ presupuesto()!.empleadoNombre }}</span>
                    </div>
                  </div>
                </div>
              }
            </div>

            <p-divider></p-divider>

            <div class="grid">
              <div class="col-12 md:col-6">
                <div class="flex flex-column gap-2">
                  <label class="text-sm font-semibold text-600">Fecha de Creación</label>
                  <div class="flex align-items-center gap-2">
                    <i class="pi pi-calendar text-color-secondary"></i>
                    <span>{{ presupuesto()!.fechaCreacion | date: 'dd/MM/yyyy HH:mm' }}</span>
                  </div>
                </div>
              </div>

              @if (presupuesto()!.fechaVencimiento) {
                <div class="col-12 md:col-6">
                  <div class="flex flex-column gap-2">
                    <label class="text-sm font-semibold text-600">Fecha de Vencimiento</label>
                    <div class="flex align-items-center gap-2">
                      <i class="pi pi-clock text-red-600"></i>
                      <span class="text-red-600">{{ presupuesto()!.fechaVencimiento | date: 'dd/MM/yyyy' }}</span>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </p-card>
      </div>

      <!-- Actions Card -->
      <div class="col-12 lg:col-4">
        <p-card>
          <ng-template pTemplate="header">
            <div class="p-3">
              <h3 class="m-0">Acciones</h3>
            </div>
          </ng-template>

          <div class="flex flex-column gap-2">
            <p-button
              label="Ver Servicio"
              icon="pi pi-eye"
              [outlined]="true"
              class="w-full">
            </p-button>

            @if (presupuesto()!.estado === EstadoPresupuesto.APROBADO) {
              <p-button
                label="Ver Orden de Trabajo"
                icon="pi pi-file"
                [outlined]="true"
                severity="success"
                class="w-full">
              </p-button>
            }

            <p-divider></p-divider>

            <p-button
              label="Editar Presupuesto"
              icon="pi pi-pencil"
              severity="secondary"
              [outlined]="true"
              class="w-full">
            </p-button>

            @if (presupuesto()!.estado === EstadoPresupuesto.PENDIENTE || presupuesto()!.estado === EstadoPresupuesto.EN_CURSO) {
              <p-button
                label="Aprobar Presupuesto"
                icon="pi pi-check"
                severity="success"
                class="w-full">
              </p-button>

              <p-button
                label="Rechazar Presupuesto"
                icon="pi pi-times"
                severity="danger"
                class="w-full">
              </p-button>
            }
          </div>
        </p-card>
      </div>
    </div>
  }
</div>
