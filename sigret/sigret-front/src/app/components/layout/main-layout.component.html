<div class="layout-wrapper" [ngClass]="containerClass">
  <!-- Topbar -->
  <div class="layout-topbar">
    <div class="layout-topbar-start">
      <button class="layout-topbar-menu-button" (click)="onMenuToggle()">
        <i class="pi pi-bars"></i>
      </button>
      
      <div class="layout-topbar-logo">
        <div class="flex align-items-center gap-3">
          <div class="flex align-items-center justify-content-center bg-primary border-round" 
               style="width: 2.5rem; height: 2.5rem;">
            <i class="pi pi-wrench text-primary-50"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold text-900 m-0">SIGRET</h1>
            <div class="flex align-items-center gap-1 text-sm text-600">
              <i class="pi pi-home text-xs"></i>
              <span>{{ getBreadcrumb() }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="layout-topbar-end">
      <!-- Notificaciones -->
      <p-button 
        icon="pi pi-bell" 
        severity="secondary"
        text
        [badge]="notificationCount() > 0 ? notificationCount().toString() : undefined"
        badgeClass="p-badge-danger"
        class="p-2">
      </p-button>
      
      <!-- Toggle Tema -->
      <p-button 
        [icon]="isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'"
        severity="secondary"
        text
        (click)="toggleTheme()"
        [title]="isDarkMode() ? 'Modo Claro' : 'Modo Oscuro'"
        class="p-2">
      </p-button>
      
      <!-- MenÃº Usuario -->
      <p-button
        class="p-2"
        severity="secondary"
        text
        (click)="userMenu.toggle($event)">
        <div class="flex align-items-center gap-2">
          <p-avatar 
            [label]="user()?.nombreCompleto ? user()!.nombreCompleto.charAt(0) : 'U'"
            shape="circle"
            size="normal"
            class="bg-primary text-primary-50">
          </p-avatar>
          <span class="hidden sm:inline text-900 font-medium">
            {{ user()?.nombreCompleto || 'Usuario' }}
          </span>
          <i class="pi pi-chevron-down text-xs text-600"></i>
        </div>
      </p-button>
      
      <p-popover #userMenu>
        <div class="w-12rem">
          <div class="px-3 py-2 border-bottom-1 surface-border">
            <div class="text-sm font-semibold text-900">{{ user()?.nombreCompleto }}</div>
            <div class="text-xs text-600">{{ user()?.email }}</div>
          </div>
          <p-menu [model]="userMenuItems" [popup]="false" class="w-full border-none"></p-menu>
        </div>
      </p-popover>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="layout-sidebar">
    <div class="layout-menu">
      @for (section of menuItems; track section.label) {
        <div class="layout-root-menuitem">
          <div class="layout-menuitem-root-text">
            <i [class]="section.icon" class="text-sm"></i>
            <span>{{ section.label }}</span>
          </div>
          
          @if (section.items) {
            <ul>
              @for (item of section.items; track item.label) {
                @if (item.children) {
                  <li [class]="{'active-menuitem': isSubmenuOpen(item.label)}">
                    <a (click)="toggleSubmenu(item.label)" class="layout-menuitem-link">
                      <i [class]="item.icon + ' layout-menuitem-icon'"></i>
                      <span class="layout-menuitem-text">{{ item.label }}</span>
                      @if (item.badge) {
                        <span class="layout-menuitem-badge">{{ item.badge }}</span>
                      }
                      <i class="pi pi-chevron-down layout-submenu-toggler"></i>
                    </a>
                    
                    <ul class="layout-submenu" 
                        [class.layout-submenu-enter-active]="isSubmenuOpen(item.label)"
                        [class.layout-submenu-leave-active]="!isSubmenuOpen(item.label)">
                      @for (child of item.children; track child.label) {
                        <li>
                          <a [routerLink]="child.routerLink"
                             routerLinkActive="active-route"
                             class="layout-menuitem-link"
                             (click)="onMenuItemClick()">
                            <i [class]="child.icon + ' layout-menuitem-icon'"></i>
                            <span class="layout-menuitem-text">{{ child.label }}</span>
                            @if (child.badge) {
                              <span class="layout-menuitem-badge">{{ child.badge }}</span>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  </li>
                } @else {
                  <li>
                    <a [routerLink]="item.routerLink"
                       routerLinkActive="active-route"
                       class="layout-menuitem-link"
                       (click)="onMenuItemClick()">
                      <i [class]="item.icon + ' layout-menuitem-icon'"></i>
                      <span class="layout-menuitem-text">{{ item.label }}</span>
                      @if (item.badge) {
                        <span class="layout-menuitem-badge">{{ item.badge }}</span>
                      }
                    </a>
                  </li>
                }
              }
            </ul>
          }
        </div>
      }
    </div>
  </div>

  <!-- Main Container -->
  <div class="layout-main-container">
    <div class="layout-main">
      <router-outlet></router-outlet>
    </div>
  </div>

  <!-- Layout Mask -->
  <div class="layout-mask animate-fadein"></div>
</div>