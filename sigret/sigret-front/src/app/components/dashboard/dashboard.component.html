<div class="flex flex-column gap-4">
  <!-- Header -->
  <div class="flex justify-content-between align-items-center flex-wrap gap-3">
    <div class="flex align-items-center gap-2">
      <p-button
        icon="pi pi-arrow-left"
        [text]="true"
        [rounded]="true"
        severity="secondary"
        (onClick)="goBack()">
      </p-button>
      <div>
        <h1 class="text-3xl font-bold text-900 mb-1">Dashboard</h1>
        <p class="text-600 m-0">Resumen general del sistema</p>
      </div>
    </div>
    <p-button
      icon="pi pi-refresh"
      [loading]="loading()"
      label="Actualizar"
      severity="secondary"
      (click)="cargarEstadisticas()"
      pTooltip="Actualizar estadísticas"
    />
  </div>

  <!-- Date Filter -->
  <div class="surface-card shadow-1 border-round border-1 surface-border p-3">
    <div class="flex align-items-center gap-3 flex-wrap">
      <i class="pi pi-filter text-600"></i>
      <span class="text-sm font-medium text-600">Filtrar por fecha:</span>
      <p-datepicker
        [(ngModel)]="fechaDesde"
        placeholder="Desde"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        [showClear]="true"
        (onSelect)="onFechaChange()"
        (onClear)="onFechaChange()"
      />
      <p-datepicker
        [(ngModel)]="fechaHasta"
        placeholder="Hasta"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        [showClear]="true"
        [minDate]="fechaDesde() ?? undefined"
        (onSelect)="onFechaChange()"
        (onClear)="onFechaChange()"
      />
      @if (tieneFiltroDeFechas()) {
        <p-button
          icon="pi pi-times"
          label="Limpiar"
          severity="danger"
          [text]="true"
          size="small"
          (click)="limpiarFiltroFechas()"
        />
      }
    </div>
  </div>

  <!-- Error State -->
  @if (error()) {
    <div class="surface-card shadow-1 border-round border-1 surface-border p-5">
      <div class="flex flex-column align-items-center gap-3">
        <i class="pi pi-exclamation-triangle text-5xl text-orange-500"></i>
        <p class="text-600 text-lg m-0">{{ error() }}</p>
        <p-button label="Reintentar" icon="pi pi-refresh" (click)="cargarEstadisticas()" />
      </div>
    </div>
  }

  <!-- Loading Skeleton -->
  @if (loading() && !estadisticas()) {
    <div class="grid">
      @for (item of skeletonCards; track item) {
        <div class="col-12 sm:col-6 lg:col">
          <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
            <div class="flex align-items-center gap-3">
              <p-skeleton shape="circle" width="3rem" height="3rem" />
              <div class="flex-1">
                <p-skeleton width="3rem" height="2rem" class="mb-2" />
                <p-skeleton width="8rem" height="1rem" />
              </div>
            </div>
          </div>
        </div>
      }
    </div>
    <div class="grid">
      @for (item of skeletonCharts; track item) {
        <div class="col-12 lg:col-6">
          <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
            <p-skeleton width="12rem" height="1.25rem" class="mb-3" />
            <p-skeleton width="100%" height="18rem" />
          </div>
        </div>
      }
    </div>
  }

  <!-- Dashboard Content -->
  @if (estadisticas()) {
    <!-- KPI Cards -->
    <div class="grid">
      <!-- Servicios Activos -->
      <div class="col-12 sm:col-6 lg:col">
        <div
          class="surface-card shadow-1 border-round border-1 surface-border p-4 kpi-card"
          (click)="navegarServicios()"
          (keydown.enter)="navegarServicios()"
          tabindex="0"
          role="button"
          aria-label="Ver servicios activos"
        >
          <div class="flex align-items-center gap-3">
            <div
              class="flex align-items-center justify-content-center border-round"
              style="width: 3rem; height: 3rem; background-color: var(--p-primary-color)"
            >
              <i class="pi pi-wrench text-white text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="text-3xl font-bold text-900">{{ serviciosActivos() }}</div>
              <div class="text-sm font-medium text-600">Servicios Activos</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Presupuestos Pendientes -->
      <div class="col-12 sm:col-6 lg:col">
        <div
          class="surface-card shadow-1 border-round border-1 surface-border p-4 kpi-card"
          (click)="navegarPresupuestos()"
          (keydown.enter)="navegarPresupuestos()"
          tabindex="0"
          role="button"
          aria-label="Ver presupuestos pendientes"
        >
          <div class="flex align-items-center gap-3">
            <div
              class="flex align-items-center justify-content-center border-round"
              style="width: 3rem; height: 3rem; background-color: #FFA726"
            >
              <i class="pi pi-file-edit text-white text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="text-3xl font-bold text-900">{{ presupuestosPendientes() }}</div>
              <div class="text-sm font-medium text-600">Presupuestos Pendientes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ordenes en Progreso -->
      <div class="col-12 sm:col-6 lg:col">
        <div
          class="surface-card shadow-1 border-round border-1 surface-border p-4 kpi-card"
          (click)="navegarOrdenes()"
          (keydown.enter)="navegarOrdenes()"
          tabindex="0"
          role="button"
          aria-label="Ver órdenes en progreso"
        >
          <div class="flex align-items-center gap-3">
            <div
              class="flex align-items-center justify-content-center border-round"
              style="width: 3rem; height: 3rem; background-color: #42A5F5"
            >
              <i class="pi pi-cog text-white text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="text-3xl font-bold text-900">{{ ordenesEnProgreso() }}</div>
              <div class="text-sm font-medium text-600">Órdenes en Progreso</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tasa Aprobacion -->
      <div class="col-12 sm:col-6 lg:col">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <div class="flex align-items-center gap-3">
            <div
              class="flex align-items-center justify-content-center border-round"
              style="width: 3rem; height: 3rem; background-color: #66BB6A"
            >
              <i class="pi pi-check-circle text-white text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="text-3xl font-bold text-900">{{ tasaAprobacion() }}%</div>
              <div class="text-sm font-medium text-600">Tasa de Aprobación</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Servicios Completados -->
      <div class="col-12 sm:col-6 lg:col">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <div class="flex align-items-center gap-3">
            <div
              class="flex align-items-center justify-content-center border-round"
              style="width: 3rem; height: 3rem; background-color: #AB47BC"
            >
              <i class="pi pi-calendar-clock text-white text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="text-3xl font-bold text-900">{{ serviciosCompletadosMes() }}</div>
              <div class="text-sm font-medium text-600">{{ labelCompletados() }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="grid">
      <!-- Servicios por Estado - Doughnut -->
      <div class="col-12 lg:col-6">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <h3 class="text-lg font-semibold text-900 mt-0 mb-3">Servicios por Estado</h3>
          <div class="chart-container">
            <div class="circular-wrapper">
              <p-chart
                type="doughnut"
                [data]="serviciosDoughnutData()"
                [options]="circularChartOptions()"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Presupuestos por Estado - Bar -->
      <div class="col-12 lg:col-6">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <h3 class="text-lg font-semibold text-900 mt-0 mb-3">Presupuestos por Estado</h3>
          <div class="chart-container">
            <p-chart
              type="bar"
              [data]="presupuestosBarData()"
              [options]="barChartOptions()"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="grid">
      <!-- Tendencia Mensual - Line -->
      <div class="col-12 lg:col-6">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <h3 class="text-lg font-semibold text-900 mt-0 mb-3">Tendencia Mensual de Servicios</h3>
          <div class="chart-container">
            <p-chart
              type="line"
              [data]="tendenciaLineData()"
              [options]="barChartOptions()"
            />
          </div>
        </div>
      </div>

      <!-- Ordenes por Estado - Pie -->
      <div class="col-12 lg:col-6">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <h3 class="text-lg font-semibold text-900 mt-0 mb-3">Órdenes de Trabajo por Estado</h3>
          <div class="chart-container">
            <div class="circular-wrapper">
              <p-chart
                type="pie"
                [data]="ordenesPieData()"
                [options]="circularChartOptions()"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row 3 -->
    <div class="grid">
      <!-- Ordenes por Empleado - Horizontal Bar -->
      <div class="col-12 lg:col-6">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <h3 class="text-lg font-semibold text-900 mt-0 mb-3">Órdenes de Trabajo por Empleado</h3>
          <div class="chart-container">
            <p-chart
              type="bar"
              [data]="ordenesPorEmpleadoData()"
              [options]="horizontalBarOptions()"
            />
          </div>
        </div>
      </div>

      <!-- Garantias por Tipo de Equipo - Bar -->
      <div class="col-12 lg:col-6">
        <div class="surface-card shadow-1 border-round border-1 surface-border p-4">
          <h3 class="text-lg font-semibold text-900 mt-0 mb-3">Garantías por Tipo de Equipo</h3>
          <div class="chart-container">
            <p-chart
              type="bar"
              [data]="garantiasPorTipoData()"
              [options]="barChartOptions()"
            />
          </div>
        </div>
      </div>
    </div>
  }
</div>
